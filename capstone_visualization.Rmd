---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 

```{r}
library(readxl)
library(tidyverse)
library(ggplot2)
library(caret)
library(glmnet)
library(readr)
library(dplyr)
library(plotly)
library(ggpmisc)
library(ggpubr)
```
```{r}
pne_flu_vacc <- read_csv('data/pne_flu_vacc.csv')
```
```{r}
glimpse(pne_flu_vacc)
```


```{r}
summarise(pne_flu_vacc, mean = mean(percent_vacc))
```
```{r}
#Looking at the trend
deaths_trend <- read_csv('data/deaths_trend.csv')
trend1 <- deaths_trend %>% 
  ggplot(aes(x = season, y = deaths_pne_flu, group = 1)) + geom_col(color = 'red', fill = 'gray')+
  #geom_area(fill = 'cyan', alpha = .1) +
  labs(x = 'Flu Season'
       , y = 'Deaths from Pneumonia and Influenza'
       , title = "") +
        theme_bw() +
  theme(axis.line = element_line(colour = "black"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    panel.border = element_blank(),
    panel.background = element_blank())
ggplotly(trend1, width = 800, height = 500)
```
```{r}
d1 <- ggplot(deaths_trend,aes(deaths_pne_flu)) + geom_histogram(aes(y=..density..), col = 'red', alpha = .2) + geom_density(col = 3) + labs(title = "Distribution of the Share of Renewable Electricity Generation Across the Countries") + labs(x = "Deaths from Pneumonia & Influenza",y = "Frequency")+
  theme(axis.text=element_text(size=12),
        axis.title=element_text(size=14,face="bold"))
ggplotly(d1, width = 800, height = 500)
```
```{r}
top_10 <- distinct(pne_flu_vacc, states, season, deaths_pne_flu) %>% 
  select(states, season, deaths_pne_flu) %>% 
  top_n(n = 10)
top_10[order(-top_10$deaths_pne_flu),]
```
```{r}
bottom_10 <- distinct(pne_flu_vacc, states, season, deaths_pne_flu) %>% 
  select(states, season, deaths_pne_flu) %>% 
  top_n(n = -10)
bottom_10[order(bottom_10$deaths_pne_flu),]
```


```{r}
tn_pne_flu <- read_csv('data/tn_pne_flu.csv')
tn_pne_flu
```
```{r}
#Looking at the trend
trend_tn <- tn_pne_flu %>% 
  ggplot(aes(x = season, y = deaths_pne_flu, group = 1)) + geom_line(color = 'red', fill = 'gray')+
  geom_area(fill = 'cyan', alpha = .1) +
  labs(x = 'Flu Season'
       , y = 'Deaths from Pneumonia and Influenza'
       , title = "") +
        theme_bw() +
  theme(axis.line = element_line(colour = "black"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    panel.border = element_blank(),
    panel.background = element_blank())
ggplotly(trend_tn, width = 800, height = 500)
```
```{r}
r1 <- tn_pne_flu %>%
  ggplot(aes(x = percent_vacc, y = deaths_pne_flu)) + geom_point(col=2,shape=1) + geom_smooth(method = "lm")+
  labs(title= "Deaths from Pneumonia & Influenza vs. Percentage Vaccination", x="Percentage Vaccination", y= "Deaths from Pneumonia & Influenza")+
  theme(axis.text=element_text(size=12),
  axis.title=element_text(size=14,face="bold"))
ggplotly(r1, width = 800, height = 500)
```
```{r}
r2 <- pne_flu_vacc %>%
  ggplot(aes(x = percent_vacc, y = deaths_pne_flu)) + geom_point(col=2,shape=1) + geom_smooth(method = "lm")+
  labs(title= "Deaths from Pneumonia & Influenza vs. Percentage Vaccination", x="Percentage Vaccination", y= "Deaths from Pneumonia & Influenza")+
  theme(axis.text=element_text(size=12),
  axis.title=element_text(size=14,face="bold"))
ggplotly(r2, width = 800, height = 500)
```
```{r}
ggscatter(pne_flu_vacc, x = "percent_vacc", y = "deaths_pne_flu", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson")+
  theme(legend.position='none')
```
```{r}
ggscatter(tn_pne_flu, x = "percent_vacc", y = "deaths_pne_flu", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson")+
  theme(legend.position='none')
```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.
